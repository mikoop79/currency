<?php

namespace Tests\Feature;

use App\Models\Report;
use App\Services\ReportGenerate\ReportTypes\BaseReport;
use App\Services\ReportGenerate\ReportTypes\Report1;
use Carbon\Carbon;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Log;
use Tests\TestCase;

class GetDateIntervalTest extends TestCase
{
    /**
     * A basic test example.
     *
     * @return void
     */
    public function test_correct_number_of_intervals_for_1_year_monthly()
    {
        $now = Carbon::now();
        $start = Carbon::now()->subYear();

        $dates = Report1::getIntervals([
            'start_date' => $start->format(BaseReport::DEFAULT_FORMAT), 'end_date' => $now->format(BaseReport::DEFAULT_FORMAT), 'carbon_interval' => '1 month'
        ]);

        $this->assertTrue(count($dates) >= 12);
    }


    public function test_correct_number_of_intervals_for_6_month_wwekly()
    {
        $now = Carbon::now();
        $start = Carbon::now()->subMonths(6);

        $dates = Report1::getIntervals([
            'start_date' => $start->format(BaseReport::DEFAULT_FORMAT), 'end_date' => $now->format(BaseReport::DEFAULT_FORMAT), 'carbon_interval' => '1 week'
        ]);

        $this->assertTrue(count($dates) >= 27 );

    }

    public function test_correct_dates_for_data()
    {
        $dates = ["2021-06-19", "2021-07-19", "2021-08-19", "2021-09-19", "2021-10-19", "2021-11-19", "2021-12-19", "2022-01-19", "2022-02-19", "2022-03-19", "2022-04-19", "2022-05-19", "2022-06-19"];
        $quotes = ['2021-06-19' => ['USDAUD' => 1.337256], '2021-06-20' => ['USDAUD' => 1.33265], '2021-06-21' => ['USDAUD' => 1.32714], '2021-06-22' => ['USDAUD' => 1.323977], '2021-06-23' => ['USDAUD' => 1.32051], '2021-06-24' => ['USDAUD' => 1.319087], '2021-06-25' => ['USDAUD' => 1.318044], '2021-06-26' => ['USDAUD' => 1.318044], '2021-06-27' => ['USDAUD' => 1.317003], '2021-06-28' => ['USDAUD' => 1.321301], '2021-06-29' => ['USDAUD' => 1.33092], '2021-06-30' => ['USDAUD' => 1.33368], '2021-07-01' => ['USDAUD' => 1.339585], '2021-07-02' => ['USDAUD' => 1.328772], '2021-07-03' => ['USDAUD' => 1.328727], '2021-07-04' => ['USDAUD' => 1.329973], '2021-07-05' => ['USDAUD' => 1.325908], '2021-07-06' => ['USDAUD' => 1.33414], '2021-07-07' => ['USDAUD' => 1.336202], '2021-07-08' => ['USDAUD' => 1.345352], '2021-07-09' => ['USDAUD' => 1.335491], '2021-07-10' => ['USDAUD' => 1.335827], '2021-07-11' => ['USDAUD' => 1.334971], '2021-07-12' => ['USDAUD' => 1.337077], '2021-07-13' => ['USDAUD' => 1.343878], '2021-07-14' => ['USDAUD' => 1.336895], '2021-07-15' => ['USDAUD' => 1.346928], '2021-07-16' => ['USDAUD' => 1.350923], '2021-07-17' => ['USDAUD' => 1.350804], '2021-07-18' => ['USDAUD' => 1.35365], '2021-07-19' => ['USDAUD' => 1.362565], '2021-07-20' => ['USDAUD' => 1.362584], '2021-07-21' => ['USDAUD' => 1.36025], '2021-07-22' => ['USDAUD' => 1.354628], '2021-07-23' => ['USDAUD' => 1.357773], '2021-07-24' => ['USDAUD' => 1.357773], '2021-07-25' => ['USDAUD' => 1.357305], '2021-07-26' => ['USDAUD' => 1.353901], '2021-07-27' => ['USDAUD' => 1.357478], '2021-07-28' => ['USDAUD' => 1.355216], '2021-07-29' => ['USDAUD' => 1.352265], '2021-07-30' => ['USDAUD' => 1.36147], '2021-07-31' => ['USDAUD' => 1.36147], '2021-08-01' => ['USDAUD' => 1.362203], '2021-08-02' => ['USDAUD' => 1.358665], '2021-08-03' => ['USDAUD' => 1.351695], '2021-08-04' => ['USDAUD' => 1.35483], '2021-08-05' => ['USDAUD' => 1.350785], '2021-08-06' => ['USDAUD' => 1.359435], '2021-08-07' => ['USDAUD' => 1.360359], '2021-08-08' => ['USDAUD' => 1.36315], '2021-08-09' => ['USDAUD' => 1.364443], '2021-08-10' => ['USDAUD' => 1.361515], '2021-08-11' => ['USDAUD' => 1.356604], '2021-08-12' => ['USDAUD' => 1.362212], '2021-08-13' => ['USDAUD' => 1.356852], '2021-08-14' => ['USDAUD' => 1.356852], '2021-08-15' => ['USDAUD' => 1.35795], '2021-08-16' => ['USDAUD' => 1.362596], '2021-08-17' => ['USDAUD' => 1.37817], '2021-08-18' => ['USDAUD' => 1.38295], '2021-08-19' => ['USDAUD' => 1.399601], '2021-08-20' => ['USDAUD' => 1.401542], '2021-08-21' => ['USDAUD' => 1.401542], '2021-08-22' => ['USDAUD' => 1.400994], '2021-08-23' => ['USDAUD' => 1.387165], '2021-08-24' => ['USDAUD' => 1.379501], '2021-08-25' => ['USDAUD' => 1.374403], '2021-08-26' => ['USDAUD' => 1.381263], '2021-08-27' => ['USDAUD' => 1.367615], '2021-08-28' => ['USDAUD' => 1.367615], '2021-08-29' => ['USDAUD' => 1.367255], '2021-08-30' => ['USDAUD' => 1.37156], '2021-08-31' => ['USDAUD' => 1.366299], '2021-09-01' => ['USDAUD' => 1.357285], '2021-09-02' => ['USDAUD' => 1.351488], '2021-09-03' => ['USDAUD' => 1.340898], '2021-09-04' => ['USDAUD' => 1.340898], '2021-09-05' => ['USDAUD' => 1.34326], '2021-09-06' => ['USDAUD' => 1.34445], '2021-09-07' => ['USDAUD' => 1.35355], '2021-09-08' => ['USDAUD' => 1.358465], '2021-09-09' => ['USDAUD' => 1.35705], '2021-09-10' => ['USDAUD' => 1.359435], '2021-09-11' => ['USDAUD' => 1.359435], '2021-09-12' => ['USDAUD' => 1.357958], '2021-09-13' => ['USDAUD' => 1.357675], '2021-09-14' => ['USDAUD' => 1.366671], '2021-09-15' => ['USDAUD' => 1.362296], '2021-09-16' => ['USDAUD' => 1.371366], '2021-09-17' => ['USDAUD' => 1.376273], '2021-09-18' => ['USDAUD' => 1.376273], '2021-09-19' => ['USDAUD' => 1.37674], '2021-09-20' => ['USDAUD' => 1.377475], '2021-09-21' => ['USDAUD' => 1.383892], '2021-09-22' => ['USDAUD' => 1.382571], '2021-09-23' => ['USDAUD' => 1.370407], '2021-09-24' => ['USDAUD' => 1.376937], '2021-09-25' => ['USDAUD' => 1.376937], '2021-09-26' => ['USDAUD' => 1.37615], '2021-09-27' => ['USDAUD' => 1.373626], '2021-09-28' => ['USDAUD' => 1.380453], '2021-09-29' => ['USDAUD' => 1.39268], '2021-09-30' => ['USDAUD' => 1.383298], '2021-10-01' => ['USDAUD' => 1.377879], '2021-10-02' => ['USDAUD' => 1.377879], '2021-10-03' => ['USDAUD' => 1.374495], '2021-10-04' => ['USDAUD' => 1.372081], '2021-10-05' => ['USDAUD' => 1.372185], '2021-10-06' => ['USDAUD' => 1.373425], '2021-10-07' => ['USDAUD' => 1.36668], '2021-10-08' => ['USDAUD' => 1.368176], '2021-10-09' => ['USDAUD' => 1.368176], '2021-10-10' => ['USDAUD' => 1.370979], '2021-10-11' => ['USDAUD' => 1.360785], '2021-10-12' => ['USDAUD' => 1.363375], '2021-10-13' => ['USDAUD' => 1.35446], '2021-10-14' => ['USDAUD' => 1.34865], '2021-10-15' => ['USDAUD' => 1.348086], '2021-10-16' => ['USDAUD' => 1.348086], '2021-10-17' => ['USDAUD' => 1.346801], '2021-10-18' => ['USDAUD' => 1.34865], '2021-10-19' => ['USDAUD' => 1.337802], '2021-10-20' => ['USDAUD' => 1.33065], '2021-10-21' => ['USDAUD' => 1.339725], '2021-10-22' => ['USDAUD' => 1.339585], '2021-10-23' => ['USDAUD' => 1.339585], '2021-10-24' => ['USDAUD' => 1.339136], '2021-10-25' => ['USDAUD' => 1.33495], '2021-10-26' => ['USDAUD' => 1.331098], '2021-10-27' => ['USDAUD' => 1.33355], '2021-10-28' => ['USDAUD' => 1.327325], '2021-10-29' => ['USDAUD' => 1.329434], '2021-10-30' => ['USDAUD' => 1.329434], '2021-10-31' => ['USDAUD' => 1.33041], '2021-11-01' => ['USDAUD' => 1.329787], '2021-11-02' => ['USDAUD' => 1.344628], '2021-11-03' => ['USDAUD' => 1.338894], '2021-11-04' => ['USDAUD' => 1.34984], '2021-11-05' => ['USDAUD' => 1.339829], '2021-11-06' => ['USDAUD' => 1.339829], '2021-11-07' => ['USDAUD' => 1.35197], '2021-11-08' => ['USDAUD' => 1.348618], '2021-11-09' => ['USDAUD' => 1.355739], '2021-11-10' => ['USDAUD' => 1.363513], '2021-11-11' => ['USDAUD' => 1.371554], '2021-11-12' => ['USDAUD' => 1.364033], '2021-11-13' => ['USDAUD' => 1.364033], '2021-11-14' => ['USDAUD' => 1.363875], '2021-11-15' => ['USDAUD' => 1.361507], '2021-11-16' => ['USDAUD' => 1.369769], '2021-11-17' => ['USDAUD' => 1.375847], '2021-11-18' => ['USDAUD' => 1.374221], '2021-11-19' => ['USDAUD' => 1.38162], '2021-11-20' => ['USDAUD' => 1.38162], '2021-11-21' => ['USDAUD' => 1.382868], '2021-11-22' => ['USDAUD' => 1.383725], '2021-11-23' => ['USDAUD' => 1.384811], '2021-11-24' => ['USDAUD' => 1.388497], '2021-11-25' => ['USDAUD' => 1.393757], '2021-11-26' => ['USDAUD' => 1.403903], '2021-11-27' => ['USDAUD' => 1.403903], '2021-11-28' => ['USDAUD' => 1.40047], '2021-11-29' => ['USDAUD' => 1.399776], '2021-11-30' => ['USDAUD' => 1.403312], '2021-12-01' => ['USDAUD' => 1.406786], '2021-12-02' => ['USDAUD' => 1.411104], '2021-12-03' => ['USDAUD' => 1.428949], '2021-12-04' => ['USDAUD' => 1.428163], '2021-12-05' => ['USDAUD' => 1.42505], '2021-12-06' => ['USDAUD' => 1.418671], '2021-12-07' => ['USDAUD' => 1.4041], '2021-12-08' => ['USDAUD' => 1.395099], '2021-12-09' => ['USDAUD' => 1.39943], '2021-12-10' => ['USDAUD' => 1.394311], '2021-12-11' => ['USDAUD' => 1.394311], '2021-12-12' => ['USDAUD' => 1.39553], '2021-12-13' => ['USDAUD' => 1.402525], '2021-12-14' => ['USDAUD' => 1.407658], '2021-12-15' => ['USDAUD' => 1.39532], '2021-12-16' => ['USDAUD' => 1.393826], '2021-12-17' => ['USDAUD' => 1.397584], '2021-12-18' => ['USDAUD' => 1.403509], '2021-12-19' => ['USDAUD' => 1.40521], '2021-12-20' => ['USDAUD' => 1.40638], '2021-12-21' => ['USDAUD' => 1.39908], '2021-12-22' => ['USDAUD' => 1.386578], '2021-12-23' => ['USDAUD' => 1.382543], '2021-12-24' => ['USDAUD' => 1.385888], '2021-12-25' => ['USDAUD' => 1.385888], '2021-12-26' => ['USDAUD' => 1.38307], '2021-12-27' => ['USDAUD' => 1.38217], '2021-12-28' => ['USDAUD' => 1.382743], '2021-12-29' => ['USDAUD' => 1.37779], '2021-12-30' => ['USDAUD' => 1.379095], '2021-12-31' => ['USDAUD' => 1.3758], '2022-01-01' => ['USDAUD' => 1.3758], '2022-01-02' => ['USDAUD' => 1.376179], '2022-01-03' => ['USDAUD' => 1.389502], '2022-01-04' => ['USDAUD' => 1.381105], '2022-01-05' => ['USDAUD' => 1.384754], '2022-01-06' => ['USDAUD' => 1.395982], '2022-01-07' => ['USDAUD' => 1.392651], '2022-01-08' => ['USDAUD' => 1.392952], '2022-01-09' => ['USDAUD' => 1.393049], '2022-01-10' => ['USDAUD' => 1.39267], '2022-01-11' => ['USDAUD' => 1.387155], '2022-01-12' => ['USDAUD' => 1.373275], '2022-01-13' => ['USDAUD' => 1.373692], '2022-01-14' => ['USDAUD' => 1.38754], '2022-01-15' => ['USDAUD' => 1.38754], '2022-01-16' => ['USDAUD' => 1.385785], '2022-01-17' => ['USDAUD' => 1.386838], '2022-01-18' => ['USDAUD' => 1.391285], '2022-01-19' => ['USDAUD' => 1.386001], '2022-01-20' => ['USDAUD' => 1.385877], '2022-01-21' => ['USDAUD' => 1.392041], '2022-01-22' => ['USDAUD' => 1.392041], '2022-01-23' => ['USDAUD' => 1.391634], '2022-01-24' => ['USDAUD' => 1.397888], '2022-01-25' => ['USDAUD' => 1.39695], '2022-01-26' => ['USDAUD' => 1.404297], '2022-01-27' => ['USDAUD' => 1.421464], '2022-01-28' => ['USDAUD' => 1.430964], '2022-01-29' => ['USDAUD' => 1.430964], '2022-01-30' => ['USDAUD' => 1.429902], '2022-01-31' => ['USDAUD' => 1.414827], '2022-02-01' => ['USDAUD' => 1.401905], '2022-02-02' => ['USDAUD' => 1.404287], '2022-02-03' => ['USDAUD' => 1.400198], '2022-02-04' => ['USDAUD' => 1.414667], '2022-02-05' => ['USDAUD' => 1.414667], '2022-02-06' => ['USDAUD' => 1.41269], '2022-02-07' => ['USDAUD' => 1.403115], '2022-02-08' => ['USDAUD' => 1.399776], '2022-02-09' => ['USDAUD' => 1.39334], '2022-02-10' => ['USDAUD' => 1.396336], '2022-02-11' => ['USDAUD' => 1.402413], '2022-02-12' => ['USDAUD' => 1.401345], '2022-02-13' => ['USDAUD' => 1.39895], '2022-02-14' => ['USDAUD' => 1.402357], '2022-02-15' => ['USDAUD' => 1.39897], '2022-02-16' => ['USDAUD' => 1.39002], '2022-02-17' => ['USDAUD' => 1.39114], '2022-02-18' => ['USDAUD' => 1.393923], '2022-02-19' => ['USDAUD' => 1.393923], '2022-02-20' => ['USDAUD' => 1.394428], '2022-02-21' => ['USDAUD' => 1.391769], '2022-02-22' => ['USDAUD' => 1.383497], '2022-02-23' => ['USDAUD' => 1.383566], '2022-02-24' => ['USDAUD' => 1.396638], '2022-02-25' => ['USDAUD' => 1.38393], '2022-02-26' => ['USDAUD' => 1.382361], '2022-02-27' => ['USDAUD' => 1.391715], '2022-02-28' => ['USDAUD' => 1.377411], '2022-03-01' => ['USDAUD' => 1.37779], '2022-03-02' => ['USDAUD' => 1.371065], '2022-03-03' => ['USDAUD' => 1.363327], '2022-03-04' => ['USDAUD' => 1.356668], '2022-03-05' => ['USDAUD' => 1.356668], '2022-03-06' => ['USDAUD' => 1.352825], '2022-03-07' => ['USDAUD' => 1.364564], '2022-03-08' => ['USDAUD' => 1.375865], '2022-03-09' => ['USDAUD' => 1.366942], '2022-03-10' => ['USDAUD' => 1.357451], '2022-03-11' => ['USDAUD' => 1.371212], '2022-03-12' => ['USDAUD' => 1.371212], '2022-03-13' => ['USDAUD' => 1.370215], '2022-03-14' => ['USDAUD' => 1.38934], '2022-03-15' => ['USDAUD' => 1.390656], '2022-03-16' => ['USDAUD' => 1.371825], '2022-03-17' => ['USDAUD' => 1.354915], '2022-03-18' => ['USDAUD' => 1.346859], '2022-03-19' => ['USDAUD' => 1.346859], '2022-03-20' => ['USDAUD' => 1.349599], '2022-03-21' => ['USDAUD' => 1.3521], '2022-03-22' => ['USDAUD' => 1.340295], '2022-03-23' => ['USDAUD' => 1.333778], '2022-03-24' => ['USDAUD' => 1.331202], '2022-03-25' => ['USDAUD' => 1.349891], '2022-03-26' => ['USDAUD' => 1.331026], '2022-03-27' => ['USDAUD' => 1.33025], '2022-03-28' => ['USDAUD' => 1.33344], '2022-03-29' => ['USDAUD' => 1.330798], '2022-03-30' => ['USDAUD' => 1.33311], '2022-03-31' => ['USDAUD' => 1.33483], '2022-04-01' => ['USDAUD' => 1.333333], '2022-04-02' => ['USDAUD' => 1.333333], '2022-04-03' => ['USDAUD' => 1.335803], '2022-04-04' => ['USDAUD' => 1.325592], '2022-04-05' => ['USDAUD' => 1.31783], '2022-04-06' => ['USDAUD' => 1.332712], '2022-04-07' => ['USDAUD' => 1.336897], '2022-04-08' => ['USDAUD' => 1.34317], '2022-04-09' => ['USDAUD' => 1.34317], '2022-04-10' => ['USDAUD' => 1.342975], '2022-04-11' => ['USDAUD' => 1.348625], '2022-04-12' => ['USDAUD' => 1.341742], '2022-04-13' => ['USDAUD' => 1.342066], '2022-04-14' => ['USDAUD' => 1.349902], '2022-04-15' => ['USDAUD' => 1.352265], '2022-04-16' => ['USDAUD' => 1.352265], '2022-04-17' => ['USDAUD' => 1.35256], '2022-04-18' => ['USDAUD' => 1.359205], '2022-04-19' => ['USDAUD' => 1.352515], '2022-04-20' => ['USDAUD' => 1.343183], '2022-04-21' => ['USDAUD' => 1.358555], '2022-04-22' => ['USDAUD' => 1.380235], '2022-04-23' => ['USDAUD' => 1.381406], '2022-04-24' => ['USDAUD' => 1.3822], '2022-04-25' => ['USDAUD' => 1.393117], '2022-04-26' => ['USDAUD' => 1.399776], '2022-04-27' => ['USDAUD' => 1.40344], '2022-04-28' => ['USDAUD' => 1.407102], '2022-04-29' => ['USDAUD' => 1.415049], '2022-04-30' => ['USDAUD' => 1.415049], '2022-05-01' => ['USDAUD' => 1.41542], '2022-05-02' => ['USDAUD' => 1.418641], '2022-05-03' => ['USDAUD' => 1.408103], '2022-05-04' => ['USDAUD' => 1.378787], '2022-05-05' => ['USDAUD' => 1.404791], '2022-05-06' => ['USDAUD' => 1.412829], '2022-05-07' => ['USDAUD' => 1.412829], '2022-05-08' => ['USDAUD' => 1.419547], '2022-05-09' => ['USDAUD' => 1.43739], '2022-05-10' => ['USDAUD' => 1.442273], '2022-05-11' => ['USDAUD' => 1.443553], '2022-05-12' => ['USDAUD' => 1.455275], '2022-05-13' => ['USDAUD' => 1.440922], '2022-05-14' => ['USDAUD' => 1.440922], '2022-05-15' => ['USDAUD' => 1.439715], '2022-05-16' => ['USDAUD' => 1.43421], '2022-05-17' => ['USDAUD' => 1.422302], '2022-05-18' => ['USDAUD' => 1.436503], '2022-05-19' => ['USDAUD' => 1.420172], '2022-05-20' => ['USDAUD' => 1.421184], '2022-05-21' => ['USDAUD' => 1.421184], '2022-05-22' => ['USDAUD' => 1.41593], '2022-05-23' => ['USDAUD' => 1.41071], '2022-05-24' => ['USDAUD' => 1.407886], '2022-05-25' => ['USDAUD' => 1.410586], '2022-05-26' => ['USDAUD' => 1.40876], '2022-05-27' => ['USDAUD' => 1.396453], '2022-05-28' => ['USDAUD' => 1.396453], '2022-05-29' => ['USDAUD' => 1.39645], '2022-05-30' => ['USDAUD' => 1.389835], '2022-05-31' => ['USDAUD' => 1.39232], '2022-06-01' => ['USDAUD' => 1.39407], '2022-06-02' => ['USDAUD' => 1.376084], '2022-06-03' => ['USDAUD' => 1.38754], '2022-06-04' => ['USDAUD' => 1.38754], '2022-06-05' => ['USDAUD' => 1.388005], '2022-06-06' => ['USDAUD' => 1.39116], '2022-06-07' => ['USDAUD' => 1.384965], '2022-06-08' => ['USDAUD' => 1.39157], '2022-06-09' => ['USDAUD' => 1.40888], '2022-06-10' => ['USDAUD' => 1.414409], '2022-06-11' => ['USDAUD' => 1.418038], '2022-06-12' => ['USDAUD' => 1.42493], '2022-06-13' => ['USDAUD' => 1.440665], '2022-06-14' => ['USDAUD' => 1.451798], '2022-06-15' => ['USDAUD' => 1.425197], '2022-06-16' => ['USDAUD' => 1.420384], '2022-06-17' => ['USDAUD' => 1.445332], '2022-06-18' => ['USDAUD' => 1.442793], '2022-06-19' => ['USDAUD' => 1.442793]];
        $datesFound = Report1::getDataByDates($quotes, $dates);

        $this->assertCount(count($dates), $datesFound);

    }
}
